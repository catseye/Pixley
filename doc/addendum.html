<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/2002/REC-xhtml1-20020801/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<title>Addendum: Pixley v1.1</title>
</head>
<body>

<h1>Addendum: Pixley v1.1</h1>

<p>So I was writing writing stuff in C to compile with DICE C for AmigaOS 1.3, right?
And I was looking for something to write, and I decided to implement Pixley in C.
And that was going pretty well; as I was implementing each command, I was making up
ad-hoc test cases for it, and I was thinking "Hey, I should record these somewhere and make a test
suite for the Pixley reference distribution!"  Of course, I never did record those cases, but
in the following weeks I started doing various other things with the Pixley project, and
at one point, decided anew that it would be a good idea to bulk up the test cases.</p>

<p>So I started writing more test cases, right?  And I got to testing <code>list?</code>.
Well, <code>(list? (lambda (x) x))</code> should be <em>false</em>, right?  Sure.
Except it wasn't.</p>

<p>Well, I went to the docs and saw that there was an easy explanation for this: in the
reference interpreter, both lists and function values are represented with lists; you tell
them apart by looking at the first element, which is <code>__lambda__</code> for a
function value and <code>__list__</code> for a list.  And <code>list?</code> was
probably just looking at the representation list and not checking the first element,
right?  Sure.  Except, no, it was much more.</p>

<p>It turns out that while function values are in fact represented by lists
with <code>__lambda__</code> as the first element, lists are just represented by lists.
Which means that there is an overlap between the types: a function value is, at the Pixley
level, a kind of list, and can be treated just like one, for example with <code>car</code>
and <code>cdr</code>.  This is clearly not kosher R<sup>5</sup>RS, which has a whole
<em>section</em> titled "Disjointness of types".  (Of course, neither "list" nor
"function value" is mentioned in that section, but I'd say the spirit of the law is pretty
clear there or whatever.)</p>

<p>So this means I had to fix Pixley!  And that's what stands before you (bundled with
the fattened test suite previously mentioned, a REPL, an implementation harness for
Mini-Scheme, and a statistics generator.)  But first, I had to make a decision: how to
represent lists?</p>

<p>Well, there were two general paths here: more meta-circular, or less.  I could
make the implementation conform to the documentation, making it less meta-circular,
but then I'd have to be changing everything that built or touched a list to build or check
for a list with <code>__list__</code> at its head.  Doable, but kind of distasteful.
Alternatively, I could make it more meta-circular: keep lists represented as lists, and
go one further by representing function values as function values.  This is a little unilluminating,
as it no longer lays bare how function values work; but this is made up for by the fact
that most of the mechanics have to continue to exist in the implementation (just in
different places) and there is a modest savings of space (because we can fall back on
the implementing language's semantics for cases like trying to execute a non-function.)
So that's what I did.</p>

<p>Now, this technically changes the semantics of the language, because gosh you
<em>could</em> have been relying on the fact that <code>(car (lambda (x) x))</code>
evaluates to <code>__lambda__</code>, in your Pixley programs, and we can't have that,
can we?  So the language version has been bumped up to 1.1.</p>

<p>One other thing deserves to be mentioned.  During my adventures in getting programs
to run under AmigaOS 1.3, I compiled Mini-Scheme thereunder, and got Pixley to run
under it by including the Pixley interpreter in Mini-Scheme's <code>init.scm</code> file and
<code>eval</code>'ing it therein.  From this I conclude that, although I have not confirmed
this is in a solid way by looking at the spec or anything, Pixley is also a strict subset of
R<sup>4</sup>RS Scheme.</p>

<p>Happy being far even as decided to use even go want to do look more like!
<br/>Chris Pressey
<br/>November 5<sup>th</sup>, 2010
<br/>Evanston, Illinois</p>

</body>
</html>
